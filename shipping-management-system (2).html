<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Prompt', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .product-selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .loader {
            border-top-color: #667eea;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 640px) {
            .mobile-card {
                display: block;
            }
            .desktop-table {
                display: none;
            }
        }
        @media (min-width: 641px) {
            .mobile-card {
                display: none;
            }
            .desktop-table {
                display: table;
            }
        }
        .cod-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .action-btn {
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.875rem;
            transition: all 0.2s;
        }
        .edit-btn {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
        }
        .edit-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }
        .delete-btn {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
        }
        .delete-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
        }
        .auto-paste-btn {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            transition: all 0.2s;
        }
        .auto-paste-btn:hover {
            transform: scale(1.02);
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        .format-info {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <div class="gradient-bg shadow-lg p-4 sm:p-6 mb-6">
        <div class="container mx-auto">
            <h1 class="text-white text-center text-2xl sm:text-3xl font-bold mb-4">üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <div class="flex justify-center gap-3 sm:gap-4 flex-wrap">
                <button onclick="showPage('input')" class="bg-white text-purple-600 px-6 sm:px-8 py-2 sm:py-3 rounded-full hover:shadow-lg transition-all font-medium text-sm sm:text-base">
                    ‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button onclick="showPage('view')" class="bg-white text-purple-600 px-6 sm:px-8 py-2 sm:py-3 rounded-full hover:shadow-lg transition-all font-medium text-sm sm:text-base">
                    üìã ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button onclick="showPage('products')" class="bg-white text-purple-600 px-6 sm:px-8 py-2 sm:py-3 rounded-full hover:shadow-lg transition-all font-medium text-sm sm:text-base">
                    üõí ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
                <button onclick="showPage('settings')" class="bg-white text-purple-600 px-6 sm:px-8 py-2 sm:py-3 rounded-full hover:shadow-lg transition-all font-medium text-sm sm:text-base">
                    ‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-16 w-16"></div>
    </div>

    <!-- Auto Format Notification -->
    <div id="autoFormatNotification" class="hidden fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all">
        <div class="flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
            </svg>
            <span>‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</span>
        </div>
    </div>

    <!-- Input Page -->
    <div id="inputPage" class="container mx-auto px-3 sm:px-4 page">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 max-w-4xl mx-auto">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="text-3xl mr-3">üìù</span>
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
            </h2>
            
            <!-- Auto Paste Helper -->
            <div class="format-info p-4 rounded-xl mb-6">
                <div class="flex items-start gap-3">
                    <span class="text-2xl">‚ú®</span>
                    <div class="flex-1">
                        <h3 class="font-semibold text-gray-800 mb-1">‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h3>
                        <p class="text-sm text-gray-700">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Line, Facebook ‡∏´‡∏£‡∏∑‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</p>
                        <div class="mt-2 flex flex-wrap gap-2">
                            <span class="inline-block bg-white px-2 py-1 rounded text-xs">‚úÖ ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö</span>
                            <span class="inline-block bg-white px-2 py-1 rounded text-xs">‚úÖ ‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö</span>
                            <span class="inline-block bg-white px-2 py-1 rounded text-xs">‚úÖ ‡∏£‡∏ß‡∏î‡πÄ‡∏£‡πá‡∏ß‡∏ó‡∏±‡∏ô‡πÉ‡∏à</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Customer Address Section -->
            <div class="mb-6 relative">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ä‡∏∑‡πà‡∏≠ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)
                </label>
                <div class="relative">
                    <textarea id="customerAddress" rows="4" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all"
                        placeholder="‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"></textarea>
                    <button onclick="clearAddress()" 
                        class="absolute top-2 right-2 text-gray-400 hover:text-red-500 transition-colors"
                        title="‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </button>
                </div>
            </div>

            <!-- Product Selection Section -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </label>
                
                <!-- Product Search/Select -->
                <div class="mb-4">
                    <select id="productSelect" onchange="addSelectedProduct()" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà --</option>
                    </select>
                </div>

                <!-- Selected Products -->
                <div id="selectedProductsList" class="space-y-2 mb-4">
                    <!-- Selected products will appear here -->
                </div>

                <!-- Add New Product Button -->
                <button onclick="showAddProductModal()" 
                    class="bg-gradient-to-r from-green-400 to-green-600 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all text-sm">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <!-- Size and Color -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÑ‡∏ã‡∏™‡πå</label>
                    <input type="text" id="productSize" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô M, L, XL">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏µ</label>
                    <input type="text" id="productColor" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏î‡∏≥, ‡∏Ç‡∏≤‡∏ß, ‡πÅ‡∏î‡∏á">
                </div>
            </div>

            <!-- COD Section -->
            <div class="mb-6 bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-xl border-2 border-orange-200">
                <div class="flex items-center mb-3">
                    <input type="checkbox" id="isCod" onchange="toggleCodAmount()" 
                        class="w-5 h-5 text-orange-600 rounded focus:ring-orange-500 mr-3">
                    <label for="isCod" class="text-sm font-medium text-gray-700 flex items-center">
                        üíµ ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (COD)
                    </label>
                </div>
                <div id="codAmountDiv" style="display: none;">
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö</label>
                    <input type="number" id="codAmount" 
                        class="w-full px-4 py-3 border-2 border-orange-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-transparent text-sm sm:text-base transition-all"
                        placeholder="0.00" step="0.01" min="0">
                </div>
            </div>

            <!-- Date -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                <input type="date" id="recordDate" 
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all">
            </div>

            <!-- Save Button -->
            <button onclick="saveOrder()" 
                class="w-full gradient-bg text-white py-3 px-6 rounded-xl hover:shadow-lg transition-all font-medium text-base sm:text-lg">
                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
        </div>
    </div>

    <!-- View Page -->
    <div id="viewPage" class="container mx-auto px-3 sm:px-4 page" style="display: none;">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="text-3xl mr-3">üìã</span>
                ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
            </h2>
            
            <!-- Summary Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                <div class="bg-gradient-to-r from-blue-100 to-blue-200 p-4 rounded-xl">
                    <div class="text-sm text-blue-700 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏≠‡∏≠‡πÄ‡∏î‡∏≠‡∏£‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div id="totalOrders" class="text-2xl font-bold text-blue-900">0</div>
                </div>
                <div class="bg-gradient-to-r from-orange-100 to-red-100 p-4 rounded-xl">
                    <div class="text-sm text-orange-700 font-medium">‡∏¢‡∏≠‡∏î COD ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                    <div id="totalCod" class="text-2xl font-bold text-orange-900">‡∏ø0.00</div>
                </div>
                <div class="bg-gradient-to-r from-green-100 to-green-200 p-4 rounded-xl">
                    <div class="text-sm text-green-700 font-medium">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô COD</div>
                    <div id="codCount" class="text-2xl font-bold text-green-900">0</div>
                </div>
            </div>
            
            <!-- Search and Filter -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                <input type="text" id="searchInput" 
                    class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterData()">
                <input type="date" id="filterDate" 
                    class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    onchange="filterData()">
                <button onclick="loadOrders()" 
                    class="bg-gradient-to-r from-gray-400 to-gray-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all">
                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>

            <!-- Desktop Table View -->
            <div class="overflow-x-auto desktop-table">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gradient-to-r from-purple-100 to-indigo-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡πÑ‡∏ã‡∏™‡πå/‡∏™‡∏µ
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                COD
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            </th>
                            <th class="px-6 py-4 text-center text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£
                            </th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data rows will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div id="mobileDataContainer" class="mobile-card space-y-4">
                <!-- Mobile cards will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Products Management Page -->
    <div id="productsPage" class="container mx-auto px-3 sm:px-4 page" style="display: none;">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="text-3xl mr-3">üõí</span>
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            </h2>
            
            <button onclick="showAddProductModal()" 
                class="mb-6 bg-gradient-to-r from-green-400 to-green-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all">
                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
            </button>

            <div id="productsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Products will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Settings Page -->
    <div id="settingsPage" class="container mx-auto px-3 sm:px-4 page" style="display: none;">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 max-w-2xl mx-auto">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="text-3xl mr-3">‚öôÔ∏è</span>
                ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö
            </h2>
            
            <!-- Auto Delete Settings -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-4 text-gray-700">üóëÔ∏è ‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</h3>
                <div class="bg-gradient-to-r from-amber-50 to-orange-50 p-5 rounded-xl border-2 border-amber-200">
                    <div class="flex items-center mb-3">
                        <input type="checkbox" id="enableAutoDelete" onchange="toggleAutoDelete()" 
                            class="w-5 h-5 text-orange-600 rounded focus:ring-orange-500 mr-3">
                        <label for="enableAutoDelete" class="text-sm font-medium text-gray-700">
                            ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
                        </label>
                    </div>
                    
                    <div id="autoDeleteOptions" style="display: none;" class="mt-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å:
                        </label>
                        <select id="autoDeleteDays" 
                            class="w-full px-4 py-3 border-2 border-amber-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-500">
                            <option value="14">14 ‡∏ß‡∏±‡∏ô</option>
                            <option value="30">30 ‡∏ß‡∏±‡∏ô</option>
                            <option value="60">60 ‡∏ß‡∏±‡∏ô</option>
                            <option value="90">90 ‡∏ß‡∏±‡∏ô</option>
                        </select>
                        
                        <button onclick="saveAutoDeleteSettings()" 
                            class="mt-4 w-full bg-gradient-to-r from-amber-500 to-orange-500 text-white py-2 rounded-xl hover:shadow-lg transition-all">
                            üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
                        </button>
                    </div>
                </div>
                
                <div class="mt-4 bg-blue-50 p-4 rounded-xl border border-blue-200">
                    <p class="text-sm text-blue-700">
                        <span class="font-semibold">üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏:</span> ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ï‡∏≤‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î 
                        ‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏î‡πâ
                    </p>
                </div>
            </div>
            
            <!-- Manual Cleanup -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-4 text-gray-700">üßπ ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏ô‡πÄ‡∏≠‡∏á</h3>
                <div class="space-y-3">
                    <button onclick="cleanupOldData(30)" 
                        class="w-full bg-gradient-to-r from-red-400 to-red-600 text-white py-3 rounded-xl hover:shadow-lg transition-all">
                        ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 30 ‡∏ß‡∏±‡∏ô
                    </button>
                    <button onclick="cleanupOldData(60)" 
                        class="w-full bg-gradient-to-r from-red-500 to-red-700 text-white py-3 rounded-xl hover:shadow-lg transition-all">
                        ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ 60 ‡∏ß‡∏±‡∏ô
                    </button>
                </div>
            </div>
            
            <!-- Current Settings Status -->
            <div class="mb-8">
                <h3 class="text-lg font-semibold mb-4 text-gray-700">üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                <div class="bg-gray-50 p-4 rounded-xl">
                    <div class="space-y-2">
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:</span>
                            <span id="autoDeleteStatus" class="text-sm font-medium">‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-sm text-gray-600">‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤:</span>
                            <span id="autoDeletePeriod" class="text-sm font-medium">-</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="bg-white rounded-2xl p-6 sm:p-8 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="text" id="newProductName" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="file" id="newProductImage" accept="image/*" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl">
                    <div id="imagePreview" class="mt-2"></div>
                </div>
                <div class="flex gap-3">
                    <button onclick="saveNewProduct()" 
                        class="flex-1 bg-gradient-to-r from-green-400 to-green-600 text-white py-2 rounded-lg hover:shadow-lg transition-all">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button onclick="closeAddProductModal()" 
                        class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-all">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal" onclick="closeModal(event)">
        <div class="bg-white p-4 rounded-2xl max-w-2xl max-h-[90vh] overflow-auto mx-4">
            <img id="modalImage" src="" alt="Product Image" class="w-full h-auto rounded-lg">
        </div>
    </div>

    <!-- Edit Order Modal -->
    <div id="editOrderModal" class="modal">
        <div class="bg-white rounded-2xl p-6 sm:p-8 max-w-4xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <h3 class="text-xl font-bold mb-4">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á</h3>
            <div class="space-y-4">
                <input type="hidden" id="editOrderId">
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ä‡∏∑‡πà‡∏≠ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)
                    </label>
                    <textarea id="editCustomerAddress" rows="4" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </textarea>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <div id="editProductsList" class="space-y-2 mb-3">
                        <!-- Selected products will be shown here -->
                    </div>
                    <select id="editProductSelect" onchange="addEditProduct()" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl">
                        <option value="">-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>
                    </select>
                </div>
                
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡πÑ‡∏ã‡∏™‡πå</label>
                        <input type="text" id="editProductSize" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏µ</label>
                        <input type="text" id="editProductColor" 
                            class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                </div>
                
                <div class="bg-gradient-to-r from-orange-50 to-red-50 p-4 rounded-xl border-2 border-orange-200">
                    <div class="flex items-center mb-3">
                        <input type="checkbox" id="editIsCod" onchange="toggleEditCodAmount()" 
                            class="w-5 h-5 text-orange-600 rounded focus:ring-orange-500 mr-3">
                        <label for="editIsCod" class="text-sm font-medium text-gray-700">
                            üíµ ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á (COD)
                        </label>
                    </div>
                    <div id="editCodAmountDiv" style="display: none;">
                        <label class="block text-sm font-medium text-gray-700 mb-2">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö</label>
                        <input type="number" id="editCodAmount" 
                            class="w-full px-4 py-3 border-2 border-orange-300 rounded-xl"
                            placeholder="0.00" step="0.01" min="0">
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                    <input type="date" id="editRecordDate" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                
                <div class="flex gap-3">
                    <button onclick="updateOrder()" 
                        class="flex-1 bg-gradient-to-r from-green-400 to-green-600 text-white py-3 rounded-xl hover:shadow-lg transition-all">
                        üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </button>
                    <button onclick="closeEditOrderModal()" 
                        class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-xl hover:bg-gray-400 transition-all">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://qepuxbnfdjfiyvvniwgr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFlcHV4Ym5mZGpmaXl2dm5pd2dyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1NjczMzkzNCwiZXhwIjoyMDcyMzA5OTM0fQ.6zigPrXq6O5WyWGYh_8hkxGPrBcnlIry28W6y2kFGHA';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Global variables
        let allProducts = [];
        let selectedProducts = [];
        let editSelectedProducts = [];
        let allOrders = [];
        let currentEditOrder = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            // Set today's date
            document.getElementById('recordDate').value = new Date().toISOString().split('T')[0];
            
            // Initialize Supabase tables if needed
            await initializeTables();
            
            // Load products
            await loadProducts();
            
            // Load settings
            loadAutoDeleteSettings();
            
            // Start auto-delete check
            startAutoDeleteCheck();
            
            // Load orders if on view page
            if (document.getElementById('viewPage').style.display !== 'none') {
                await loadOrders();
            }
            
            // Setup auto-format
            setupAutoFormat();
        });

        // Initialize Supabase tables
        async function initializeTables() {
            // Create settings table if not exists
            try {
                // This would normally be done in Supabase dashboard
                console.log('Supabase initialized');
            } catch (error) {
                console.error('Error initializing tables:', error);
            }
        }

        // Auto-Format Address System
        function setupAutoFormat() {
            const addressField = document.getElementById('customerAddress');
            const editAddressField = document.getElementById('editCustomerAddress');
            
            // Auto-paste from clipboard when page gets focus
            let lastClipboardContent = '';
            
            async function checkAndAutoPaste() {
                if (document.getElementById('inputPage').style.display !== 'none' && 
                    document.getElementById('customerAddress').value === '') {
                    try {
                        const clipboardText = await navigator.clipboard.readText();
                        
                        // Check if there's new content and field is empty
                        if (clipboardText && clipboardText !== lastClipboardContent) {
                            lastClipboardContent = clipboardText;
                            
                            // Show confirmation dialog
                            if (confirm(`üìã ‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î:\n\n${clipboardText.substring(0, 100)}${clipboardText.length > 100 ? '...' : ''}\n\n‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡πÉ‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?`)) {
                                // Paste original text without formatting
                                addressField.value = clipboardText;
                                showAutoFormatNotification();
                            }
                        }
                    } catch (err) {
                        // Permission denied or clipboard API not available
                        console.log('Clipboard access denied or not available');
                    }
                }
            }
            
            // Check clipboard when window gets focus
            window.addEventListener('focus', checkAndAutoPaste);
            
            // Check clipboard when switching to input page
            document.addEventListener('click', function(e) {
                if (e.target.textContent && e.target.textContent.includes('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•')) {
                    setTimeout(checkAndAutoPaste, 100);
                }
            });
        }

        // Show auto-format notification
        function showAutoFormatNotification() {
            const notification = document.getElementById('autoFormatNotification');
            notification.innerHTML = `
                <div class="flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    <span>‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!</span>
                </div>
            `;
            notification.classList.remove('hidden');
            notification.classList.add('pulse-animation');
            
            setTimeout(() => {
                notification.classList.add('hidden');
                notification.classList.remove('pulse-animation');
            }, 3000);
        }

        // Clear address field
        function clearAddress() {
            document.getElementById('customerAddress').value = '';
        }

        // Toggle COD Amount field
        function toggleCodAmount() {
            const checkbox = document.getElementById('isCod');
            const amountDiv = document.getElementById('codAmountDiv');
            const amountInput = document.getElementById('codAmount');
            
            if (checkbox.checked) {
                amountDiv.style.display = 'block';
                amountInput.required = true;
            } else {
                amountDiv.style.display = 'none';
                amountInput.required = false;
                amountInput.value = '';
            }
        }

        // Toggle Edit COD Amount field
        function toggleEditCodAmount() {
            const checkbox = document.getElementById('editIsCod');
            const amountDiv = document.getElementById('editCodAmountDiv');
            const amountInput = document.getElementById('editCodAmount');
            
            if (checkbox.checked) {
                amountDiv.style.display = 'block';
                amountInput.required = true;
            } else {
                amountDiv.style.display = 'none';
                amountInput.required = false;
                amountInput.value = '';
            }
        }

        // Show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').classList.remove('hidden');
        }

        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').classList.add('hidden');
        }

        // Page Navigation
        function showPage(page) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(p => p.style.display = 'none');
            
            if (page === 'input') {
                document.getElementById('inputPage').style.display = 'block';
                loadProducts();
            } else if (page === 'view') {
                document.getElementById('viewPage').style.display = 'block';
                loadOrders();
            } else if (page === 'products') {
                document.getElementById('productsPage').style.display = 'block';
                loadProducts();
                displayProductsManagement();
            } else if (page === 'settings') {
                document.getElementById('settingsPage').style.display = 'block';
                loadAutoDeleteSettings();
            }
        }

        // Load Products from Supabase
        async function loadProducts() {
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                
                allProducts = data || [];
                updateProductSelect();
            } catch (error) {
                console.error('Error loading products:', error);
                // Use demo products if error
                allProducts = [
                    { id: 1, name: '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î', image_url: '' },
                    { id: 2, name: '‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡πå', image_url: '' }
                ];
                updateProductSelect();
            } finally {
                hideLoading();
            }
        }

        // Update Product Select Dropdown
        function updateProductSelect() {
            const select = document.getElementById('productSelect');
            select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà --</option>';
            
            allProducts.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = product.name;
                select.appendChild(option);
            });
            
            // Update edit modal select too
            const editSelect = document.getElementById('editProductSelect');
            if (editSelect) {
                editSelect.innerHTML = '<option value="">-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ --</option>';
                allProducts.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product.id;
                    option.textContent = product.name;
                    editSelect.appendChild(option);
                });
            }
        }

        // Add Selected Product
        function addSelectedProduct() {
            const select = document.getElementById('productSelect');
            const productId = select.value;
            
            if (!productId) return;
            
            const product = allProducts.find(p => p.id == productId);
            if (!product) return;
            
            // Check if already selected
            if (selectedProducts.find(p => p.id == productId)) {
                alert('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                select.value = '';
                return;
            }
            
            selectedProducts.push(product);
            displaySelectedProducts();
            select.value = '';
        }

        // Display Selected Products
        function displaySelectedProducts() {
            const container = document.getElementById('selectedProductsList');
            
            if (selectedProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }
            
            container.innerHTML = selectedProducts.map((product, index) => `
                <div class="flex items-center justify-between bg-purple-50 p-3 rounded-lg">
                    <div class="flex items-center gap-3">
                        ${product.image_url ? 
                            `<img src="${product.image_url}" class="w-12 h-12 object-cover rounded">` :
                            `<div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center">
                                <span class="text-gray-400">üì¶</span>
                            </div>`
                        }
                        <span class="font-medium">${product.name}</span>
                    </div>
                    <button onclick="removeSelectedProduct(${index})" 
                        class="text-red-500 hover:text-red-700">
                        ‚ùå
                    </button>
                </div>
            `).join('');
        }

        // Remove Selected Product
        function removeSelectedProduct(index) {
            selectedProducts.splice(index, 1);
            displaySelectedProducts();
        }

        // Show Add Product Modal
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.add('active');
        }

        // Close Add Product Modal
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('active');
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductImage').value = '';
            document.getElementById('imagePreview').innerHTML = '';
        }

        // Handle image preview
        document.getElementById('newProductImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = 
                        `<img src="${e.target.result}" class="w-full h-32 object-cover rounded-lg mt-2">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Save New Product
        async function saveNewProduct() {
            const name = document.getElementById('newProductName').value.trim();
            const imageFile = document.getElementById('newProductImage').files[0];
            
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            showLoading();
            try {
                let imageUrl = '';
                
                // Upload image if provided
                if (imageFile) {
                    const fileName = `${Date.now()}_${imageFile.name}`;
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('products')
                        .upload(fileName, imageFile);
                    
                    if (uploadError) throw uploadError;
                    
                    const { data: urlData } = supabase.storage
                        .from('products')
                        .getPublicUrl(fileName);
                    
                    imageUrl = urlData.publicUrl;
                }
                
                // Save product to database
                const { data, error } = await supabase
                    .from('products')
                    .insert([{ name, image_url: imageUrl }])
                    .select();
                
                if (error) throw error;
                
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                closeAddProductModal();
                await loadProducts();
                
                if (document.getElementById('productsPage').style.display !== 'none') {
                    displayProductsManagement();
                }
            } catch (error) {
                console.error('Error saving product:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Display Products Management
        function displayProductsManagement() {
            const container = document.getElementById('productsList');
            
            if (allProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center col-span-full">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }
            
            container.innerHTML = allProducts.map(product => `
                <div class="product-card bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-purple-400">
                    ${product.image_url ? 
                        `<img src="${product.image_url}" class="w-full h-40 object-cover rounded-lg mb-3">` :
                        `<div class="w-full h-40 bg-gray-100 rounded-lg mb-3 flex items-center justify-center">
                            <span class="text-6xl">üì¶</span>
                        </div>`
                    }
                    <h3 class="font-semibold text-lg">${product.name}</h3>
                    <button onclick="deleteProduct(${product.id})" 
                        class="mt-3 w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition-all text-sm">
                        ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>
            `).join('');
        }

        // Delete Product
        async function deleteProduct(productId) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            
            showLoading();
            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', productId);
                
                if (error) throw error;
                
                alert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                await loadProducts();
                displayProductsManagement();
            } catch (error) {
                console.error('Error deleting product:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Save Order
        async function saveOrder() {
            const customerAddress = document.getElementById('customerAddress').value.trim();
            const productSize = document.getElementById('productSize').value.trim();
            const productColor = document.getElementById('productColor').value.trim();
            const recordDate = document.getElementById('recordDate').value;
            const isCod = document.getElementById('isCod').checked;
            const codAmount = isCod ? parseFloat(document.getElementById('codAmount').value) || 0 : 0;
            
            if (!customerAddress) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á');
                return;
            }
            
            if (selectedProducts.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }
            
            if (isCod && (!codAmount || codAmount <= 0)) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö');
                return;
            }
            
            showLoading();
            try {
                const orderData = {
                    customer_address: customerAddress,
                    products: selectedProducts.map(p => ({
                        id: p.id,
                        name: p.name,
                        image_url: p.image_url
                    })),
                    product_size: productSize,
                    product_color: productColor,
                    record_date: recordDate,
                    is_cod: isCod,
                    cod_amount: codAmount,
                    created_at: new Date().toISOString()
                };
                
                const { error } = await supabase
                    .from('orders')
                    .insert([orderData]);
                
                if (error) throw error;
                
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                
                // Clear form
                document.getElementById('customerAddress').value = '';
                document.getElementById('productSize').value = '';
                document.getElementById('productColor').value = '';
                document.getElementById('recordDate').value = new Date().toISOString().split('T')[0];
                document.getElementById('isCod').checked = false;
                document.getElementById('codAmount').value = '';
                document.getElementById('codAmountDiv').style.display = 'none';
                selectedProducts = [];
                displaySelectedProducts();
            } catch (error) {
                console.error('Error saving order:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Load Orders
        async function loadOrders() {
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select('*')
                    .order('record_date', { ascending: false });
                
                if (error) throw error;
                
                allOrders = data || [];
                displayOrders(allOrders);
                updateSummaryStats(allOrders);
            } catch (error) {
                console.error('Error loading orders:', error);
                allOrders = [];
                displayOrders([]);
                updateSummaryStats([]);
            } finally {
                hideLoading();
            }
        }

        // Update Summary Statistics
        function updateSummaryStats(orders) {
            const totalOrders = orders.length;
            const codOrders = orders.filter(o => o.is_cod);
            const codCount = codOrders.length;
            const totalCod = codOrders.reduce((sum, o) => sum + (o.cod_amount || 0), 0);
            
            document.getElementById('totalOrders').textContent = totalOrders;
            document.getElementById('codCount').textContent = codCount;
            document.getElementById('totalCod').textContent = `‡∏ø${totalCod.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
        }

        // Display Orders
        function displayOrders(orders) {
            const tbody = document.getElementById('dataTableBody');
            const mobileContainer = document.getElementById('mobileDataContainer');
            
            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="7" class="px-6 py-8 text-center text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </td>
                    </tr>
                `;
                mobileContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </div>
                `;
                return;
            }
            
            // Desktop Table
            tbody.innerHTML = orders.map(order => {
                const productNames = order.products.map(p => p.name).join(', ');
                const productImages = order.products.map(p => 
                    p.image_url ? 
                    `<img src="${p.image_url}" alt="${p.name}" 
                        class="w-16 h-16 object-cover rounded-lg cursor-pointer inline-block mr-2"
                        onclick="showImageModal('${p.image_url}')">` : 
                    '<span class="inline-block w-16 h-16 bg-gray-100 rounded-lg mr-2 text-center leading-[4rem]">üì¶</span>'
                ).join('');
                
                const codDisplay = order.is_cod ? 
                    `<span class="cod-badge">‡∏ø${(order.cod_amount || 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</span>` : 
                    '<span class="text-gray-400">-</span>';
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${new Date(order.record_date).toLocaleDateString('th-TH')}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            <div class="flex items-start gap-2">
                                <div class="whitespace-pre-wrap flex-1">${order.customer_address}</div>
                                <button onclick="copyToClipboard('${order.customer_address.replace(/'/g, "\\'")}', event)" 
                                    class="text-purple-500 hover:text-purple-700 p-1 flex-shrink-0"
                                    title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            ${productNames}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${order.product_size || '-'} / ${order.product_color || '-'}
                        </td>
                        <td class="px-6 py-4">
                            ${codDisplay}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-wrap gap-2">
                                ${productImages}
                            </div>
                        </td>
                        <td class="px-6 py-4 text-center">
                            <div class="flex gap-2 justify-center">
                                <button onclick="editOrder(${order.id})" 
                                    class="action-btn edit-btn">
                                    ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </button>
                                <button onclick="deleteOrder(${order.id})" 
                                    class="action-btn delete-btn">
                                    üóëÔ∏è ‡∏•‡∏ö
                                </button>
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Mobile Cards
            mobileContainer.innerHTML = orders.map(order => {
                const productNames = order.products.map(p => p.name).join(', ');
                const productImages = order.products.map(p => 
                    p.image_url ? 
                    `<img src="${p.image_url}" alt="${p.name}" 
                        class="w-16 h-16 object-cover rounded-lg cursor-pointer inline-block"
                        onclick="showImageModal('${p.image_url}')">` : 
                    '<span class="inline-block w-16 h-16 bg-gray-100 rounded-lg text-center leading-[4rem]">üì¶</span>'
                ).join('');
                
                return `
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 space-y-4">
                        <div class="flex justify-between items-start">
                            <span class="text-sm font-medium text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>
                            <span class="text-sm text-gray-900 font-medium">${new Date(order.record_date).toLocaleDateString('th-TH')}</span>
                        </div>
                        
                        ${order.is_cod ? `
                        <div class="flex justify-between items-center">
                            <span class="text-sm font-medium text-gray-600">COD:</span>
                            <span class="cod-badge">‡∏ø${(order.cod_amount || 0).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ",")}</span>
                        </div>
                        ` : ''}
                        
                        <div class="border-t pt-3">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-sm font-medium text-gray-600">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span>
                                <button onclick="copyToClipboard('${order.customer_address.replace(/'/g, "\\'")}', event)" 
                                    class="text-purple-500 hover:text-purple-700 p-1"
                                    title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                            <div class="text-sm text-gray-900 whitespace-pre-wrap bg-purple-50 p-3 rounded-lg">
                                ${order.customer_address}
                            </div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <span class="text-sm font-medium text-gray-600">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</span>
                            <div class="text-sm text-gray-900 mt-1 font-medium">${productNames}</div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <span class="text-sm font-medium text-gray-600">‡πÑ‡∏ã‡∏™‡πå/‡∏™‡∏µ:</span>
                            <div class="text-sm text-gray-900">${order.product_size || '-'} / ${order.product_color || '-'}</div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <span class="text-sm font-medium text-gray-600 block mb-2">‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</span>
                            <div class="flex flex-wrap gap-2">
                                ${productImages}
                            </div>
                        </div>
                        
                        <div class="border-t pt-3 flex gap-2">
                            <button onclick="editOrder(${order.id})" 
                                class="flex-1 action-btn edit-btn text-center">
                                ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                            </button>
                            <button onclick="deleteOrder(${order.id})" 
                                class="flex-1 action-btn delete-btn text-center">
                                üóëÔ∏è ‡∏•‡∏ö
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Edit Order
        async function editOrder(orderId) {
            const order = allOrders.find(o => o.id === orderId);
            if (!order) return;
            
            currentEditOrder = order;
            editSelectedProducts = order.products || [];
            
            // Populate edit form
            document.getElementById('editOrderId').value = order.id;
            document.getElementById('editCustomerAddress').value = order.customer_address;
            document.getElementById('editProductSize').value = order.product_size || '';
            document.getElementById('editProductColor').value = order.product_color || '';
            document.getElementById('editRecordDate').value = order.record_date;
            document.getElementById('editIsCod').checked = order.is_cod;
            document.getElementById('editCodAmount').value = order.cod_amount || '';
            
            // Show/hide COD amount field
            const codAmountDiv = document.getElementById('editCodAmountDiv');
            codAmountDiv.style.display = order.is_cod ? 'block' : 'none';
            
            // Display selected products
            displayEditProducts();
            
            // Show modal
            document.getElementById('editOrderModal').classList.add('active');
        }

        // Display Edit Products
        function displayEditProducts() {
            const container = document.getElementById('editProductsList');
            
            if (editSelectedProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }
            
            container.innerHTML = editSelectedProducts.map((product, index) => `
                <div class="flex items-center justify-between bg-purple-50 p-3 rounded-lg">
                    <div class="flex items-center gap-3">
                        ${product.image_url ? 
                            `<img src="${product.image_url}" class="w-12 h-12 object-cover rounded">` :
                            `<div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center">
                                <span class="text-gray-400">üì¶</span>
                            </div>`
                        }
                        <span class="font-medium">${product.name}</span>
                    </div>
                    <button onclick="removeEditProduct(${index})" 
                        class="text-red-500 hover:text-red-700">
                        ‚ùå
                    </button>
                </div>
            `).join('');
        }

        // Add Edit Product
        function addEditProduct() {
            const select = document.getElementById('editProductSelect');
            const productId = select.value;
            
            if (!productId) return;
            
            const product = allProducts.find(p => p.id == productId);
            if (!product) return;
            
            // Check if already selected
            if (editSelectedProducts.find(p => p.id == productId)) {
                alert('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                select.value = '';
                return;
            }
            
            editSelectedProducts.push(product);
            displayEditProducts();
            select.value = '';
        }

        // Remove Edit Product
        function removeEditProduct(index) {
            editSelectedProducts.splice(index, 1);
            displayEditProducts();
        }

        // Close Edit Order Modal
        function closeEditOrderModal() {
            document.getElementById('editOrderModal').classList.remove('active');
            currentEditOrder = null;
            editSelectedProducts = [];
        }

        // Update Order
        async function updateOrder() {
            const orderId = document.getElementById('editOrderId').value;
            const customerAddress = document.getElementById('editCustomerAddress').value.trim();
            const productSize = document.getElementById('editProductSize').value.trim();
            const productColor = document.getElementById('editProductColor').value.trim();
            const recordDate = document.getElementById('editRecordDate').value;
            const isCod = document.getElementById('editIsCod').checked;
            const codAmount = isCod ? parseFloat(document.getElementById('editCodAmount').value) || 0 : 0;
            
            if (!customerAddress) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á');
                return;
            }
            
            if (editSelectedProducts.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }
            
            if (isCod && (!codAmount || codAmount <= 0)) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πá‡∏ö');
                return;
            }
            
            showLoading();
            try {
                const updateData = {
                    customer_address: customerAddress,
                    products: editSelectedProducts.map(p => ({
                        id: p.id,
                        name: p.name,
                        image_url: p.image_url
                    })),
                    product_size: productSize,
                    product_color: productColor,
                    record_date: recordDate,
                    is_cod: isCod,
                    cod_amount: codAmount
                };
                
                const { error } = await supabase
                    .from('orders')
                    .update(updateData)
                    .eq('id', orderId);
                
                if (error) throw error;
                
                alert('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                closeEditOrderModal();
                await loadOrders();
            } catch (error) {
                console.error('Error updating order:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Delete Order
        async function deleteOrder(orderId) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            
            showLoading();
            try {
                const { error } = await supabase
                    .from('orders')
                    .delete()
                    .eq('id', orderId);
                
                if (error) throw error;
                
                alert('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                await loadOrders();
            } catch (error) {
                console.error('Error deleting order:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Filter Data
        function filterData() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            const filterDate = document.getElementById('filterDate').value;
            
            let filteredData = allOrders;
            
            if (searchValue) {
                filteredData = filteredData.filter(order => 
                    order.customer_address.toLowerCase().includes(searchValue) ||
                    order.products.some(p => p.name.toLowerCase().includes(searchValue)) ||
                    order.product_size?.toLowerCase().includes(searchValue) ||
                    order.product_color?.toLowerCase().includes(searchValue)
                );
            }
            
            if (filterDate) {
                filteredData = filteredData.filter(order => 
                    order.record_date === filterDate
                );
            }
            
            displayOrders(filteredData);
            updateSummaryStats(filteredData);
        }

        // Auto Delete Settings
        function toggleAutoDelete() {
            const checkbox = document.getElementById('enableAutoDelete');
            const options = document.getElementById('autoDeleteOptions');
            
            options.style.display = checkbox.checked ? 'block' : 'none';
        }

        // Save Auto Delete Settings
        async function saveAutoDeleteSettings() {
            const enabled = document.getElementById('enableAutoDelete').checked;
            const days = parseInt(document.getElementById('autoDeleteDays').value);
            
            const settings = {
                auto_delete_enabled: enabled,
                auto_delete_days: days
            };
            
            // Save to localStorage (for demo purposes)
            localStorage.setItem('autoDeleteSettings', JSON.stringify(settings));
            
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
            loadAutoDeleteSettings();
        }

        // Load Auto Delete Settings
        function loadAutoDeleteSettings() {
            const settings = JSON.parse(localStorage.getItem('autoDeleteSettings') || '{}');
            
            const enabled = settings.auto_delete_enabled || false;
            const days = settings.auto_delete_days || 30;
            
            document.getElementById('enableAutoDelete').checked = enabled;
            document.getElementById('autoDeleteDays').value = days;
            document.getElementById('autoDeleteOptions').style.display = enabled ? 'block' : 'none';
            
            // Update status display
            document.getElementById('autoDeleteStatus').textContent = enabled ? '‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô' : '‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô';
            document.getElementById('autoDeletePeriod').textContent = enabled ? `${days} ‡∏ß‡∏±‡∏ô` : '-';
        }

        // Cleanup Old Data
        async function cleanupOldData(days) {
            if (!confirm(`‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ ${days} ‡∏ß‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà? ‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÑ‡∏î‡πâ`)) return;
            
            showLoading();
            try {
                const cutoffDate = new Date();
                cutoffDate.setDate(cutoffDate.getDate() - days);
                
                const { data, error } = await supabase
                    .from('orders')
                    .delete()
                    .lt('record_date', cutoffDate.toISOString().split('T')[0]);
                
                if (error) throw error;
                
                alert(`‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡∏ß‡πà‡∏≤ ${days} ‡∏ß‡∏±‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
                await loadOrders();
            } catch (error) {
                console.error('Error cleaning up data:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Start Auto Delete Check
        function startAutoDeleteCheck() {
            // Check every hour
            setInterval(async () => {
                const settings = JSON.parse(localStorage.getItem('autoDeleteSettings') || '{}');
                
                if (settings.auto_delete_enabled) {
                    const days = settings.auto_delete_days || 30;
                    const cutoffDate = new Date();
                    cutoffDate.setDate(cutoffDate.getDate() - days);
                    
                    try {
                        const { error } = await supabase
                            .from('orders')
                            .delete()
                            .lt('record_date', cutoffDate.toISOString().split('T')[0]);
                        
                        if (!error) {
                            console.log('Auto-delete completed');
                        }
                    } catch (error) {
                        console.error('Auto-delete error:', error);
                    }
                }
            }, 3600000); // Check every hour
        }

        // Copy to Clipboard
        function copyToClipboard(text, event) {
            navigator.clipboard.writeText(text).then(() => {
                // Show success notification
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 2000);
                
                // Change button color temporarily
                const button = event.currentTarget;
                button.classList.add('text-green-500');
                setTimeout(() => {
                    button.classList.remove('text-green-500');
                }, 2000);
            }).catch(err => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                // Show success notification
                const notification = document.createElement('div');
                notification.innerHTML = `
                    <div class="fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transition-all flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                        </svg>
                        <span>‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</span>
                    </div>
                `;
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    notification.remove();
                }, 2000);
                
                // Change button color temporarily
                const button = event.currentTarget;
                button.classList.add('text-green-500');
                setTimeout(() => {
                    button.classList.remove('text-green-500');
                }, 2000);
            });
        }

        // Image Modal
        function showImageModal(imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            modalImage.src = imageUrl;
            modal.classList.add('active');
        }

        function closeModal(event) {
            if (event.target.id === 'imageModal') {
                document.getElementById('imageModal').classList.remove('active');
            }
        }
    </script>

    <!-- Supabase Setup Note -->
    <div class="container mx-auto px-4 mt-8 mb-4">
        <div class="bg-gradient-to-r from-purple-100 to-indigo-100 border border-purple-300 rounded-2xl p-6 max-w-4xl mx-auto">
            <h3 class="font-bold text-lg mb-3 text-purple-800">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase:</h3>
            <p class="text-sm text-purple-700 mb-3">
                ‚ö° ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠
            </p>
            <div class="bg-white/80 p-3 rounded-lg">
                <h4 class="font-semibold text-purple-700 mb-2">‚ú® ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏á‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥:</h4>
                <ul class="text-sm text-purple-600 space-y-1">
                    <li>‚Ä¢ ‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Line, Facebook ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏ß‡πá‡∏ö</li>
                    <li>‚Ä¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡∏ñ‡∏≤‡∏°‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</li>
                    <li>‚Ä¢ ‡∏ß‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ö‡∏ö‡∏ï‡πâ‡∏ô‡∏â‡∏ö‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á</li>
                    <li>‚Ä¢ ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô "‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!" ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</li>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>