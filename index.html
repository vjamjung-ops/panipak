<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Prompt', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .product-card {
            transition: all 0.3s ease;
        }
        .product-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        .product-selected {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .copy-tooltip {
            position: absolute;
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 10;
            white-space: nowrap;
        }
        .copy-tooltip.show {
            opacity: 1;
        }
        .loader {
            border-top-color: #667eea;
            -webkit-animation: spinner 1.5s linear infinite;
            animation: spinner 1.5s linear infinite;
        }
        @-webkit-keyframes spinner {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @media (max-width: 640px) {
            .mobile-card {
                display: block;
            }
            .desktop-table {
                display: none;
            }
        }
        @media (min-width: 641px) {
            .mobile-card {
                display: none;
            }
            .desktop-table {
                display: table;
            }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-50 to-indigo-100 min-h-screen">
    <!-- Header -->
    <div class="gradient-bg shadow-lg p-4 sm:p-6 mb-6">
        <div class="container mx-auto">
            <h1 class="text-white text-center text-2xl sm:text-3xl font-bold mb-4">üì¶ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
            <div class="flex justify-center gap-3 sm:gap-4">
                <button onclick="showPage('input')" class="bg-white text-purple-600 px-6 sm:px-8 py-2 sm:py-3 rounded-full hover:shadow-lg transition-all font-medium text-sm sm:text-base">
                    ‚ûï ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button onclick="showPage('view')" class="bg-white text-purple-600 px-6 sm:px-8 py-2 sm:py-3 rounded-full hover:shadow-lg transition-all font-medium text-sm sm:text-base">
                    üìã ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
                <button onclick="showPage('products')" class="bg-white text-purple-600 px-6 sm:px-8 py-2 sm:py-3 rounded-full hover:shadow-lg transition-all font-medium text-sm sm:text-base">
                    üõçÔ∏è ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-16 w-16"></div>
    </div>

    <!-- Input Page -->
    <div id="inputPage" class="container mx-auto px-3 sm:px-4 page">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 max-w-4xl mx-auto">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="text-3xl mr-3">üìù</span>
                ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
            </h2>
            
            <!-- Customer Address Section -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">
                    ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á (‡∏ä‡∏∑‡πà‡∏≠ ‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà ‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£)
                </label>
                <textarea id="customerAddress" rows="4" 
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all"
                    placeholder="‡∏ä‡∏∑‡πà‡∏≠: ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ&#10;‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà: 123 ‡∏´‡∏°‡∏π‡πà 4 ‡∏ï.‡∏ö‡∏≤‡∏á‡πÅ‡∏™‡∏ô ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ 20000&#10;‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£: 081-234-5678"></textarea>
            </div>

            <!-- Product Selection Section -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-3">
                    ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                </label>
                
                <!-- Product Search/Select -->
                <div class="mb-4">
                    <select id="productSelect" onchange="addSelectedProduct()" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà --</option>
                    </select>
                </div>

                <!-- Selected Products -->
                <div id="selectedProductsList" class="space-y-2 mb-4">
                    <!-- Selected products will appear here -->
                </div>

                <!-- Add New Product Button -->
                <button onclick="showAddProductModal()" 
                    class="bg-gradient-to-r from-green-400 to-green-600 text-white px-4 py-2 rounded-lg hover:shadow-lg transition-all text-sm">
                    ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
                </button>
            </div>

            <!-- Size and Color -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡πÑ‡∏ã‡∏™‡πå</label>
                    <input type="text" id="productSize" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô M, L, XL">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏™‡∏µ</label>
                    <input type="text" id="productColor" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all"
                        placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏î‡∏≥, ‡∏Ç‡∏≤‡∏ß, ‡πÅ‡∏î‡∏á">
                </div>
            </div>

            <!-- Date -->
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</label>
                <input type="date" id="recordDate" 
                    class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent text-sm sm:text-base transition-all">
            </div>

            <!-- Save Button -->
            <button onclick="saveOrder()" 
                class="w-full gradient-bg text-white py-3 px-6 rounded-xl hover:shadow-lg transition-all font-medium text-base sm:text-lg">
                üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
            </button>
        </div>
    </div>

    <!-- View Page -->
    <div id="viewPage" class="container mx-auto px-3 sm:px-4 page" style="display: none;">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="text-3xl mr-3">üìã</span>
                ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏™‡πà‡∏á
            </h2>
            
            <!-- Search and Filter -->
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6">
                <input type="text" id="searchInput" 
                    class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterData()">
                <input type="date" id="filterDate" 
                    class="px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    onchange="filterData()">
                <button onclick="loadOrders()" 
                    class="bg-gradient-to-r from-gray-400 to-gray-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all">
                    üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                </button>
            </div>

            <!-- Desktop Table View -->
            <div class="overflow-x-auto desktop-table">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gradient-to-r from-purple-100 to-indigo-100">
                        <tr>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡πÑ‡∏ã‡∏™‡πå/‡∏™‡∏µ
                            </th>
                            <th class="px-6 py-4 text-left text-xs font-medium text-gray-700 uppercase tracking-wider">
                                ‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                            </th>
                        </tr>
                    </thead>
                    <tbody id="dataTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Data rows will be inserted here -->
                    </tbody>
                </table>
            </div>

            <!-- Mobile Card View -->
            <div id="mobileDataContainer" class="mobile-card space-y-4">
                <!-- Mobile cards will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Products Management Page -->
    <div id="productsPage" class="container mx-auto px-3 sm:px-4 page" style="display: none;">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            <h2 class="text-2xl sm:text-3xl font-bold mb-6 text-gray-800 flex items-center">
                <span class="text-3xl mr-3">üõçÔ∏è</span>
                ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            </h2>
            
            <button onclick="showAddProductModal()" 
                class="mb-6 bg-gradient-to-r from-green-400 to-green-600 text-white px-6 py-3 rounded-xl hover:shadow-lg transition-all">
                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà
            </button>

            <div id="productsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Products will be displayed here -->
            </div>
        </div>
    </div>

    <!-- Add Product Modal -->
    <div id="addProductModal" class="modal">
        <div class="bg-white rounded-2xl p-6 sm:p-8 max-w-md w-full mx-4">
            <h3 class="text-xl font-bold mb-4">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="text" id="newProductName" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-purple-500">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</label>
                    <input type="file" id="newProductImage" accept="image/*" 
                        class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl">
                    <div id="imagePreview" class="mt-2"></div>
                </div>
                <div class="flex gap-3">
                    <button onclick="saveNewProduct()" 
                        class="flex-1 bg-gradient-to-r from-green-400 to-green-600 text-white py-2 rounded-lg hover:shadow-lg transition-all">
                        ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
                    </button>
                    <button onclick="closeAddProductModal()" 
                        class="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg hover:bg-gray-400 transition-all">
                        ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Modal -->
    <div id="imageModal" class="modal" onclick="closeModal(event)">
        <div class="bg-white p-4 rounded-2xl max-w-2xl max-h-[90vh] overflow-auto mx-4">
            <img id="modalImage" src="" alt="Product Image" class="w-full h-auto rounded-lg">
        </div>
    </div>

    <!-- Copy Tooltip -->
    <div id="copyTooltip" class="copy-tooltip">‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß!</div>

    <script>
        // Supabase Configuration
        const SUPABASE_URL = 'https://qepuxbnfdjfiyvvniwgr.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFlcHV4Ym5mZGpmaXl2dm5pd2dyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MzM5MzQsImV4cCI6MjA3MjMwOTkzNH0.eUkaQjJ8buEfG2OMZX9D24nZw1OyEvICwxQCDAK0sp8';
        
        // Initialize Supabase client
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

        // Global variables
        let allProducts = [];
        let selectedProducts = [];
        let allOrders = [];

        // Initialize
        document.addEventListener('DOMContentLoaded', async function() {
            // Set today's date
            document.getElementById('recordDate').value = new Date().toISOString().split('T')[0];
            
            // Initialize Supabase tables if needed
            await initializeTables();
            
            // Load products
            await loadProducts();
            
            // Load orders if on view page
            if (document.getElementById('viewPage').style.display !== 'none') {
                await loadOrders();
            }
        });

        // Initialize Supabase tables
        async function initializeTables() {
            // This function would normally create tables, but they should be created via Supabase dashboard
            console.log('Supabase initialized');
        }

        // Show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').classList.remove('hidden');
        }

        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').classList.add('hidden');
        }

        // Page Navigation
        function showPage(page) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(p => p.style.display = 'none');
            
            if (page === 'input') {
                document.getElementById('inputPage').style.display = 'block';
                loadProducts();
            } else if (page === 'view') {
                document.getElementById('viewPage').style.display = 'block';
                loadOrders();
            } else if (page === 'products') {
                document.getElementById('productsPage').style.display = 'block';
                loadProducts();
                displayProductsManagement();
            }
        }

        // Load Products from Supabase
        async function loadProducts() {
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('products')
                    .select('*')
                    .order('name');
                
                if (error) throw error;
                
                allProducts = data || [];
                updateProductSelect();
            } catch (error) {
                console.error('Error loading products:', error);
                // Use demo products if error
                allProducts = [
                    { id: 1, name: '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏¢‡∏∑‡∏î', image_url: '' },
                    { id: 2, name: '‡∏Å‡∏≤‡∏á‡πÄ‡∏Å‡∏á‡∏¢‡∏µ‡∏ô‡∏™‡πå', image_url: '' }
                ];
                updateProductSelect();
            } finally {
                hideLoading();
            }
        }

        // Update Product Select Dropdown
        function updateProductSelect() {
            const select = document.getElementById('productSelect');
            select.innerHTML = '<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà --</option>';
            
            allProducts.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = product.name;
                select.appendChild(option);
            });
        }

        // Add Selected Product
        function addSelectedProduct() {
            const select = document.getElementById('productSelect');
            const productId = select.value;
            
            if (!productId) return;
            
            const product = allProducts.find(p => p.id == productId);
            if (!product) return;
            
            // Check if already selected
            if (selectedProducts.find(p => p.id == productId)) {
                alert('‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏ñ‡∏π‡∏Å‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏•‡πâ‡∏ß');
                select.value = '';
                return;
            }
            
            selectedProducts.push(product);
            displaySelectedProducts();
            select.value = '';
        }

        // Display Selected Products
        function displaySelectedProducts() {
            const container = document.getElementById('selectedProductsList');
            
            if (selectedProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }
            
            container.innerHTML = selectedProducts.map((product, index) => `
                <div class="flex items-center justify-between bg-purple-50 p-3 rounded-lg">
                    <div class="flex items-center gap-3">
                        ${product.image_url ? 
                            `<img src="${product.image_url}" class="w-12 h-12 object-cover rounded">` :
                            `<div class="w-12 h-12 bg-gray-200 rounded flex items-center justify-center">
                                <span class="text-gray-400">üì¶</span>
                            </div>`
                        }
                        <span class="font-medium">${product.name}</span>
                    </div>
                    <button onclick="removeSelectedProduct(${index})" 
                        class="text-red-500 hover:text-red-700">
                        ‚ùå
                    </button>
                </div>
            `).join('');
        }

        // Remove Selected Product
        function removeSelectedProduct(index) {
            selectedProducts.splice(index, 1);
            displaySelectedProducts();
        }

        // Show Add Product Modal
        function showAddProductModal() {
            document.getElementById('addProductModal').classList.add('active');
        }

        // Close Add Product Modal
        function closeAddProductModal() {
            document.getElementById('addProductModal').classList.remove('active');
            document.getElementById('newProductName').value = '';
            document.getElementById('newProductImage').value = '';
            document.getElementById('imagePreview').innerHTML = '';
        }

        // Handle image preview
        document.getElementById('newProductImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('imagePreview').innerHTML = 
                        `<img src="${e.target.result}" class="w-full h-32 object-cover rounded-lg mt-2">`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Save New Product
        async function saveNewProduct() {
            const name = document.getElementById('newProductName').value.trim();
            const imageFile = document.getElementById('newProductImage').files[0];
            
            if (!name) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤');
                return;
            }
            
            showLoading();
            try {
                let imageUrl = '';
                
                // Upload image if provided
                if (imageFile) {
                    const fileName = `${Date.now()}_${imageFile.name}`;
                    const { data: uploadData, error: uploadError } = await supabase.storage
                        .from('products')
                        .upload(fileName, imageFile);
                    
                    if (uploadError) throw uploadError;
                    
                    const { data: urlData } = supabase.storage
                        .from('products')
                        .getPublicUrl(fileName);
                    
                    imageUrl = urlData.publicUrl;
                }
                
                // Save product to database
                const { data, error } = await supabase
                    .from('products')
                    .insert([{ name, image_url: imageUrl }])
                    .select();
                
                if (error) throw error;
                
                alert('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                closeAddProductModal();
                await loadProducts();
                
                if (document.getElementById('productsPage').style.display !== 'none') {
                    displayProductsManagement();
                }
            } catch (error) {
                console.error('Error saving product:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Display Products Management
        function displayProductsManagement() {
            const container = document.getElementById('productsList');
            
            if (allProducts.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center col-span-full">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</p>';
                return;
            }
            
            container.innerHTML = allProducts.map(product => `
                <div class="product-card bg-white border-2 border-gray-200 rounded-xl p-4 hover:border-purple-400">
                    ${product.image_url ? 
                        `<img src="${product.image_url}" class="w-full h-40 object-cover rounded-lg mb-3">` :
                        `<div class="w-full h-40 bg-gray-100 rounded-lg mb-3 flex items-center justify-center">
                            <span class="text-6xl">üì¶</span>
                        </div>`
                    }
                    <h3 class="font-semibold text-lg">${product.name}</h3>
                    <button onclick="deleteProduct(${product.id})" 
                        class="mt-3 w-full bg-red-500 text-white py-2 rounded-lg hover:bg-red-600 transition-all text-sm">
                        ‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>
            `).join('');
        }

        // Delete Product
        async function deleteProduct(productId) {
            if (!confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
            
            showLoading();
            try {
                const { error } = await supabase
                    .from('products')
                    .delete()
                    .eq('id', productId);
                
                if (error) throw error;
                
                alert('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                await loadProducts();
                displayProductsManagement();
            } catch (error) {
                console.error('Error deleting product:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Save Order
        async function saveOrder() {
            const customerAddress = document.getElementById('customerAddress').value.trim();
            const productSize = document.getElementById('productSize').value.trim();
            const productColor = document.getElementById('productColor').value.trim();
            const recordDate = document.getElementById('recordDate').value;
            
            if (!customerAddress) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏à‡∏±‡∏î‡∏™‡πà‡∏á');
                return;
            }
            
            if (selectedProducts.length === 0) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                return;
            }
            
            showLoading();
            try {
                const orderData = {
                    customer_address: customerAddress,
                    products: selectedProducts.map(p => ({
                        id: p.id,
                        name: p.name,
                        image_url: p.image_url
                    })),
                    product_size: productSize,
                    product_color: productColor,
                    record_date: recordDate,
                    created_at: new Date().toISOString()
                };
                
                const { error } = await supabase
                    .from('orders')
                    .insert([orderData]);
                
                if (error) throw error;
                
                alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
                
                // Clear form
                document.getElementById('customerAddress').value = '';
                document.getElementById('productSize').value = '';
                document.getElementById('productColor').value = '';
                document.getElementById('recordDate').value = new Date().toISOString().split('T')[0];
                selectedProducts = [];
                displaySelectedProducts();
            } catch (error) {
                console.error('Error saving order:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // Load Orders
        async function loadOrders() {
            showLoading();
            try {
                const { data, error } = await supabase
                    .from('orders')
                    .select('*')
                    .order('record_date', { ascending: false });
                
                if (error) throw error;
                
                allOrders = data || [];
                displayOrders(allOrders);
            } catch (error) {
                console.error('Error loading orders:', error);
                allOrders = [];
                displayOrders([]);
            } finally {
                hideLoading();
            }
        }

        // Display Orders
        function displayOrders(orders) {
            const tbody = document.getElementById('dataTableBody');
            const mobileContainer = document.getElementById('mobileDataContainer');
            
            if (orders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                            ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                        </td>
                    </tr>
                `;
                mobileContainer.innerHTML = `
                    <div class="text-center text-gray-500 py-8">
                        ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </div>
                `;
                return;
            }
            
            // Desktop Table
            tbody.innerHTML = orders.map(order => {
                const productNames = order.products.map(p => p.name).join(', ');
                const productImages = order.products.map(p => 
                    p.image_url ? 
                    `<img src="${p.image_url}" alt="${p.name}" 
                        class="w-16 h-16 object-cover rounded-lg cursor-pointer inline-block mr-2"
                        onclick="showImageModal('${p.image_url}')">` : 
                    '<span class="inline-block w-16 h-16 bg-gray-100 rounded-lg mr-2 text-center leading-[4rem]">üì¶</span>'
                ).join('');
                
                return `
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${new Date(order.record_date).toLocaleDateString('th-TH')}
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            <div class="flex items-start gap-2">
                                <div class="whitespace-pre-wrap flex-1">${order.customer_address}</div>
                                <button onclick="copyToClipboard('${order.customer_address.replace(/'/g, "\\'")}', event)" 
                                    class="text-purple-500 hover:text-purple-700 p-1 flex-shrink-0"
                                    title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-sm text-gray-900">
                            ${productNames}
                        </td>
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                            ${order.product_size || '-'} / ${order.product_color || '-'}
                        </td>
                        <td class="px-6 py-4">
                            <div class="flex flex-wrap gap-2">
                                ${productImages}
                            </div>
                        </td>
                    </tr>
                `;
            }).join('');
            
            // Mobile Cards
            mobileContainer.innerHTML = orders.map(order => {
                const productNames = order.products.map(p => p.name).join(', ');
                const productImages = order.products.map(p => 
                    p.image_url ? 
                    `<img src="${p.image_url}" alt="${p.name}" 
                        class="w-16 h-16 object-cover rounded-lg cursor-pointer inline-block"
                        onclick="showImageModal('${p.image_url}')">` : 
                    '<span class="inline-block w-16 h-16 bg-gray-100 rounded-lg text-center leading-[4rem]">üì¶</span>'
                ).join('');
                
                return `
                    <div class="bg-white border-2 border-gray-200 rounded-xl p-5 space-y-4">
                        <div class="flex justify-between items-start">
                            <span class="text-sm font-medium text-gray-600">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</span>
                            <span class="text-sm text-gray-900 font-medium">${new Date(order.record_date).toLocaleDateString('th-TH')}</span>
                        </div>
                        
                        <div class="border-t pt-3">
                            <div class="flex justify-between items-start mb-2">
                                <span class="text-sm font-medium text-gray-600">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤:</span>
                                <button onclick="copyToClipboard('${order.customer_address.replace(/'/g, "\\'")}', event)" 
                                    class="text-purple-500 hover:text-purple-700 p-1"
                                    title="‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                            d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3">
                                        </path>
                                    </svg>
                                </button>
                            </div>
                            <div class="text-sm text-gray-900 whitespace-pre-wrap bg-purple-50 p-3 rounded-lg">
                                ${order.customer_address}
                            </div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <span class="text-sm font-medium text-gray-600">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</span>
                            <div class="text-sm text-gray-900 mt-1 font-medium">${productNames}</div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <span class="text-sm font-medium text-gray-600">‡πÑ‡∏ã‡∏™‡πå/‡∏™‡∏µ:</span>
                            <div class="text-sm text-gray-900">${order.product_size || '-'} / ${order.product_color || '-'}</div>
                        </div>
                        
                        <div class="border-t pt-3">
                            <span class="text-sm font-medium text-gray-600 block mb-2">‡∏£‡∏π‡∏õ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:</span>
                            <div class="flex flex-wrap gap-2">
                                ${productImages}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Filter Data
        function filterData() {
            const searchValue = document.getElementById('searchInput').value.toLowerCase();
            const filterDate = document.getElementById('filterDate').value;
            
            let filteredData = allOrders;
            
            if (searchValue) {
                filteredData = filteredData.filter(order => 
                    order.customer_address.toLowerCase().includes(searchValue) ||
                    order.products.some(p => p.name.toLowerCase().includes(searchValue)) ||
                    order.product_size?.toLowerCase().includes(searchValue) ||
                    order.product_color?.toLowerCase().includes(searchValue)
                );
            }
            
            if (filterDate) {
                filteredData = filteredData.filter(order => 
                    order.record_date === filterDate
                );
            }
            
            displayOrders(filteredData);
        }

        // Copy to Clipboard
        function copyToClipboard(text, event) {
            navigator.clipboard.writeText(text).then(() => {
                const tooltip = document.getElementById('copyTooltip');
                const button = event.currentTarget;
                const rect = button.getBoundingClientRect();
                
                tooltip.style.left = rect.left + 'px';
                tooltip.style.top = (rect.top - 30) + 'px';
                tooltip.classList.add('show');
                
                setTimeout(() => {
                    tooltip.classList.remove('show');
                }, 2000);
            }).catch(err => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const tooltip = document.getElementById('copyTooltip');
                const button = event.currentTarget;
                const rect = button.getBoundingClientRect();
                
                tooltip.style.left = rect.left + 'px';
                tooltip.style.top = (rect.top - 30) + 'px';
                tooltip.classList.add('show');
                
                setTimeout(() => {
                    tooltip.classList.remove('show');
                }, 2000);
            });
        }

        // Image Modal
        function showImageModal(imageUrl) {
            const modal = document.getElementById('imageModal');
            const modalImage = document.getElementById('modalImage');
            modalImage.src = imageUrl;
            modal.classList.add('active');
        }

        function closeModal(event) {
            if (event.target.id === 'imageModal') {
                document.getElementById('imageModal').classList.remove('active');
            }
        }
    </script>

    <!-- Supabase Setup Note -->
    <div class="container mx-auto px-4 mt-8 mb-4">
        <div class="bg-gradient-to-r from-purple-100 to-indigo-100 border border-purple-300 rounded-2xl p-6 max-w-4xl mx-auto">
            <h3 class="font-bold text-lg mb-3 text-purple-800">‚öôÔ∏è ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Supabase:</h3>
            <p class="text-sm text-purple-700 mb-3">
                ‚ö° ‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß! ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏ô Supabase ‡∏î‡πâ‡∏ß‡∏¢ SQL ‡∏ô‡∏µ‡πâ:
            </p>
            <pre class="bg-white p-3 rounded-lg text-xs overflow-x-auto border border-purple-200">
-- Create products table
CREATE TABLE products (
  id SERIAL PRIMARY KEY,
  name TEXT NOT NULL,
  image_url TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Create orders table  
CREATE TABLE orders (
  id SERIAL PRIMARY KEY,
  customer_address TEXT NOT NULL,
  products JSONB NOT NULL,
  product_size TEXT,
  product_color TEXT,
  record_date DATE NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Enable RLS
ALTER TABLE products ENABLE ROW LEVEL SECURITY;
ALTER TABLE orders ENABLE ROW LEVEL SECURITY;

-- Create policies for public access
CREATE POLICY "Public Access" ON products FOR ALL USING (true);
CREATE POLICY "Public Access" ON orders FOR ALL USING (true);

-- Create storage bucket
INSERT INTO storage.buckets (id, name, public) 
VALUES ('products', 'products', true);</pre>
        </div>
    </div>
</body>
</html>
